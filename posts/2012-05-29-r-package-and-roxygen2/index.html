<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>R包制作和roxygen2使用说明 - Yulong Niu</title><link rel="icon" type="image/png" href=icons/favicon.ico /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="R包制作和roxygen2使用说明" />
<meta property="og:description" content="制作R包的记录。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://YulongNiu.github.io/posts/2012-05-29-r-package-and-roxygen2/" />
<meta property="article:published_time" content="2012-05-29T19:46:59-04:00" />
<meta property="article:modified_time" content="2012-05-29T19:46:59-04:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="R包制作和roxygen2使用说明"/>
<meta name="twitter:description" content="制作R包的记录。"/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">
  <link rel="stylesheet" type="text/css" media="screen" href="https://YulongNiu.github.io/css/bootstrap-table.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://YulongNiu.github.io/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://YulongNiu.github.io/css/main.css" />
	<link rel="stylesheet" type="text/css" href="https://YulongNiu.github.io/css/custom.css" />
	<link rel="stylesheet" type="text/css" href="https://YulongNiu.github.io/css/dark.css" media="(prefers-color-scheme: dark)" />
	<link rel="stylesheet" type="text/css" href="https://YulongNiu.github.io/css/custom-dark.css" media="(prefers-color-scheme: dark)" />

	
	
	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
	<script src="https://YulongNiu.github.io/js/main.js"></script>
	<script src="https://YulongNiu.github.io/js/abc.js"></script>
	<script src="https://YulongNiu.github.io/js/xyz.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<h1 class="site-title"><a href="https://YulongNiu.github.io/">Yulong Niu</a></h1>
	<div class="site-description"><h2>个人博客</h2><nav class="nav social">
			<ul class="flat"><a href="https://github.com/YulongNiu" title="Github"><i data-feather="github"></i></a><a href="https://twitter.com/YulongNiu" title="Twitter"><i data-feather="twitter"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">Posts</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">R包制作和roxygen2使用说明</h1>
			<div class="meta">Posted at &mdash; May 29, 2012</div>
		</div>

		<div class="markdown">
			

<p>查看创建R包的各种细节，权威的文献是<a href="http://cran.r-project.org/doc/manuals/r-release/R-exts.html">Writing R Extensions</a>。</p>

<h2 id="1-创建r包目录">1. 创建R包目录</h2>

<p>像盖房子一样，创建R包需要先搭建一个骨架，这个骨架往往是固定的，即一些文件夹（如<code>R</code>，<code>man</code>等）和文件（如<code>DESCRIPTION</code>，<code>NAMESPACE</code>）是必须的，而另外一些则可选择性添加。一个典型的R包目录,比如<span style="color: blue">Biobase</span>包，如下图：</p>

<p><img src="/images/r_catalog.png" alt="r_catalog" /></p>

<h3 id="1-1-description-文件">1.1 <code>DESCRIPTION</code>文件</h3>

<p>一个纯文本ASCII文件，其中Package, Version, License, Description, Title, Author和Maintainer是必备条目，一个例子<span style="color: blue">knitr</span>包的<code>DESCRIPTION</code>文件：</p>

<ul>
<li><p>Package：由字母、数字和“点”构成的，至少含有两个字符，第一个必须是字母，结束不能用“点”（这也是包名称的命名规范）。</p></li>

<li><p>Version：版本号，经典的命名方式比如0.1-0。</p></li>

<li><p>License：GPL。</p></li>

<li><p>Description：一段话描述包主要的功能。</p></li>

<li><p>Title：包的一句话解释。</p></li>

<li><p>Author和Maintainer：包的作者和维护者，姓+名 （比如Karl Pearson ）。也可以使使用Author@R描述作者，使用R函数<code>person()</code>，其中变量<code>role</code>的选项<code>aut</code>表示author，<code>cre</code>表示creator（维护者），<code>ctb</code>表示contributor。一个例子：</p></li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">c(person(<span style="color:#a31515">&#34;Hadley&#34;</span>, <span style="color:#a31515">&#34;Wickham&#34;</span>, email = <span style="color:#a31515">&#34;hadley@rice.edu&#34;</span>, role =<span style="color:#a31515">&#34;ctb&#34;</span>),  
person(<span style="color:#a31515">&#34;Yihui&#34;</span>, <span style="color:#a31515">&#34;Xie&#34;</span>, email = <span style="color:#a31515">&#34;xie@yihui.name&#34;</span>, role = c(<span style="color:#a31515">&#34;aut&#34;</span>, <span style="color:#a31515">&#34;cre&#34;</span>)))</code></pre></div>
<ul>
<li><p>Date（可选）：当前版本包日期，格式yyyy-mm-dd。</p></li>

<li><p>Depends（可选）：依赖的R环境版本和包名称，比如 <code>R (&gt;= 2.14.1)</code>。</p></li>
</ul>

<p><span style="color: blue">注意：</span></p>

<blockquote>
<ol>
<li><p>加上版本号，没有版本号等于没用，因为版本之间可能差异很大；</p></li>

<li><p>对于<span style="color: blue">base</span>等这样的包就不用写了，因为是必然依赖的，同时也是R启动自动载入的。对于依赖的包名称，在R 2.14.0之后完全没有必要写，因为从这个版本后，所有包都有<code>NAMESPACE</code>，直接使用<code>Imports</code>就可以了。</p></li>
</ol>
</blockquote>

<ul>
<li><p>Imports（可选）：如果只是使用某些包中类、方法或者（一般）函数，而不用完全载入包，可以在此栏列出包的名称，最好加上版本号（在<code>R CMD check</code>会检查版本）。在代码中，引用其他包的namespace可以使用<code>::</code>或者<code>:::</code>操作符。与之对应的，需要在<code>NAMESPACE</code>文件中指明引用（见后）。</p></li>

<li><p>Suggests（可选）：如果只是在帮助文档的<code>examples</code>，<code>tests</code>或者vignettes中用到了一些包，那么没有必要“依赖”或者“引用”，只用“建议”安装即可。版本号同样也要加上，在<code>R CMD check</code>时会用到。当然，我们要考虑到如果读者也想重现一下<code>examples/tests/vignettes</code>的例子，最好使用<code>if(require(pkgname)))</code>{:.languag-r}的条件句控制：<code>TRUE</code>{:.languag-r}执行，<code>FALSE</code>{:.languag-r}返回错误。</p></li>

<li><p>Enhances（可选）：这个条目中的包可以被这个正在创建的包“增强”功能，比如我们创建的这个包为（对列表中的包）提供了更好的方法、更优秀的处理手段等。</p></li>

<li><p>URL（可选）：一系列相关的网址，使用“逗号”或者空格隔开。链接可能是作者的主页、包的补充材料等。</p></li>

<li><p>BugReports（可选）：一个网址，用于提交bug，代替了向作者发邮件。一个好的想法是使用<a href="https://github.com/">Github</a>，在项目的issures版块提交bug。</p></li>

<li><p>Collate（可选）：看不懂。</p></li>

<li><p>KeepSource（可选）：逻辑值，设定为<code>TRUE</code>{:.languag-r}，表示包是源码。</p></li>

<li><p>ByteCompile（可选）：逻辑值，目前默认设置为否；如果性能确实可以得到提升，可以选择<code>TRUE</code>{:.languag-r}，但这可能增加安装时间和体积。</p></li>

<li><p>BuildVignettes（可选）：如果设定位<code>FALSE</code>{:.languag-r}，<code>R CMD build</code>{:.languag-bash}不会重新编辑vignette，同时<code>R CMD check</code>{:.languag-bash}也不会检查。</p></li>
</ul>

<h3 id="1-2-包目录下的各种文件夹说明">1.2 包目录下的各种文件夹说明</h3>

<ul>
<li><p>R文件夹：这个文件夹下放置用R语言写成的源代码，文件最好使用后缀<code>*.R</code>。</p></li>

<li><p>man文件夹：man文件夹下放置<code>*.Rd</code>结尾的文档，这写文档详细描述的函数的用途。如果使用roxygen2，就不需要建立这个文件夹。</p></li>

<li><p>src文件夹：放置用其他语言写成的代码，比如C/C++/Fortran等。</p></li>

<li><p>data文件夹：放置一些data文件，比如R代码、表格（<code>*txt</code>/<code>*.tab</code>/<code>*.csv</code>）文件或者是用<code>save()</code>函数保存的镜像（<code>*.RData</code>/<code>*.rda</code>）。这些文件必须是“自给自足”的，即不用调用包也能使用这些data。如果这些data比较大，可以将其压缩为<code>*.gzip</code>/<code>*.bzip2</code>/<code>*.xz</code>格式，或者在保存镜像时，使用<code>save(, compress = TRUE)</code>。这些方法可以有效地减少包的体积和安装时间，以方便用户使用。如果原始数据，比如<code>test.csv</code>{.language-bash}文件，可以放入<code>inst/extdata/</code>{.language-bash}文件夹。引用这类数据，使用<code>system.file(&quot;extdata&quot;, &quot;test.csv&quot;, package = &quot;myPkg&quot;)</code>{:.languag-r}。</p></li>

<li><p>demo文件夹：放置一些包的示例，通过<code>demo()</code>函数访问。（需要有一个00Index文件？不能自动生成？）</p></li>

<li><p>exec文件夹：放置脚本文件比如shell、Perl、Python、Tcl等。</p></li>

<li><p>inst文件夹：包在编译安装中，会将这个文件下的文件放入包的根目录下，所以可以放包的更新文件NEWS（或者CHANGELOG）文件、用于引用的CITATION文件等。还有很重要的子文件夹是doc，vignette文件就放在此处，格式为*.Rnw，这个文件会进一步被编程成LaTeX文件，最后生成常见的PDF文档。现在Swear过时了，用<span style="color: blue">knitr</span>吧。</p></li>
</ul>

<h2 id="2-namespace-文件">2. <code>NAMESPACE</code>文件</h2>

<h3 id="2-1-文件说明">2.1 文件说明</h3>

<p><code>NAMESPACE</code>文件非常重要，因为它指明哪些函数是“输出（export）”给用户使用，哪些又是从其他包中“输入（import）”的。如果作者没有指明这个文件，那么在创建包时会被自动创建，此时所有的对象都被输出，在<code>Imports</code>和<code>Depends</code>下的包全部被输入。</p>

<p><strong>“输出”格式</strong>：<code>export(f, g)</code>，其中<code>f</code>和<code>g</code>是变量名，一般不用引号括起。也可以使用正则表达式批量输出，比如 <code>exportPattern(&quot;^[^\\.]&quot;)</code>。</p>

<p><strong>“输入”格式</strong>：<code>import(for, bar)</code>，其中<code>for</code>和<code>bar</code>是包名称，这样做会导致<code>for</code>和<code>bar</code>中所有的输出对象都被引用。如果我们只想引用其中的某几个对象， 可以使用<code>importFrom(foo, f, g)</code>，其中<code>f</code>和<code>g</code>是<code>foo</code>包的变量名。<span style="color: blue">Base</span>包的命名空间被默认引用。当然，也可以输出其他包的变量，前提是这些变量需要先被输入。</p>

<h3 id="2-2-s3类">2.2 S3类</h3>

<p><code>S3method(Mymethod, Myclass)</code></p>

<h3 id="2-3-s4类">2.3 S4类</h3>

<p><strong>“输出”格式</strong>：如果创建的S4类需要被外部调用，使用<code>exportClasses(Myclass1, Myclass2)</code>，同样可以使用<code>exportClassPattern()</code>批量输出。对于S4，输出“方法（methods）”也会输出“泛函（generic）”，输出泛函同样也会输出方法。如果一个方法，在要创建的包中没有找到对应的方法，有两种可能的情况：</p>

<blockquote>
<ol>
<li><p>泛函已经从别的包中输入，比如<code>importMethods()</code>；</p></li>

<li><p>从别的包中输入函数，但被转换为默认方法，比如<code>importFrom(&quot;graphics&quot;, plot)</code>，<code>plot()</code>函数又被分配其他的方法，这种情况下输入自己包的<code>plot()</code>函数，使用<code>exportMethods(plot)</code>。</p></li>
</ol>
</blockquote>

<p><strong>“输入”格式</strong>：输入某个包的全部类或者特定的类，<code>ImportClasses(pkg)</code>或者<code>ImportClassesFrom(pkg, class1)</code>；输入某个包全部方法或者特定方法，<code>ImportMethods(pkg)</code>或者<code>ImportMethodsFrom(pkg, method1)</code>。</p>

<p><span style="color: blue">stats4</span>给出的例子非常好，R 2.15.0之后，对隐式泛函要求严格，必须先输入显示函数：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">  export(mle) 
  importFrom(<span style="color:#a31515">&#34;graphics&#34;</span>, plot) 
  importFrom(<span style="color:#a31515">&#34;stats&#34;</span>, optim, qchisq) 
  <span style="color:#008000">## For these, we define methods or (AIC, BIC, nobs) an implicit generic: </span>
  importFrom(<span style="color:#a31515">&#34;stats&#34;</span>, AIC, BIC, coef, confint, logLik, nobs, profile, update, vcov)   exportClasses(mle, profile.mle, summary.mle) 
  <span style="color:#008000">## All methods for imported generics: </span>
  exportMethods(coef, confint, logLik, plot, profile, summary, show, update, vcov)
  <span style="color:#008000">## implicit generics which do not have any methods here </span>
  export(AIC, BIC, nobs)</code></pre></div>
<h2 id="3-书写r函数帮助文档">3. 书写R函数帮助文档</h2>

<p>书写函数文档的利器当属Emacs+ESS+<span style="color: blue">roxygen2</span>包。Emacs+ESS搭建了一个非常棒的统计学软件（R、SAS、S-Plus等）的代码编辑和运行环境，从ESS命名Emacs Speaks Statistics上就可以感受到它外漏的霸气。而<a href="http://roxygen.org/">roxygen2</a>是R的一个包，仿照Doxygen构建的工具，实现了文档和源码用一个文件共同管理的想法。</p>

<p>这个想法相当棒：</p>

<blockquote>
<ol>
<li><p>在写代码时，方便“就地”编写文档（函数功能、参数解释、实现功能、注意事项、依赖关系和例子等）；</p></li>

<li><p>在源码修改时，及时地更新文档。</p></li>
</ol>
</blockquote>

<p>对于编辑R包来说，对应的文档是<code>*.Rd</code>（R documentation）格式的文件，以下是一个框架示意图：</p>

<p>{% img middle /images/r_rd.png 600 600 &lsquo;Rd file #1&rsquo; &lsquo;a snap of Rd file framework&rsquo; %}</p>

<h3 id="3-1-span-style-color-blue-roxygen2-span-使用注释">3.1 <span style="color: blue">roxygen2</span>使用注释</h3>

<ul>
<li><p><code>@title</code>：文档标题，通常是函数名缩写（比如首字母缩写）的解释。出现在该函数文档的标题位置和检索（index）目录。</p></li>

<li><p><code>@aliases</code>：函数别名。这个函数的别名，如果使用，在HTML帮助文档中将出现这个别名，链接的文档还是原来函数文档；同样，<code>?“别名”</code>也能调出帮助文件。具体参考<span style="color: blue">stats</span>包中，“Normal”是<code>dnorm()</code>，<code>pnorm()</code>，<code>qnorm()</code>，<code>rnorm()</code>三个函数的别名。</p></li>

<li><p><code>@description</code>：描述，对函数进行稍微详细的描述，可以讲解函数的功能，不能有空行。出现在文档开始位置。</p></li>

<li><p><code>@details</code>：函数的具体描述，啰嗦各种细节，比如在运行过程中的注意事项、输入结果解释、运用的公式等。</p></li>

<li><p><code>@param</code>：各个变量（argument）的解释。</p></li>

<li><p><code>@inheritParams</code>：用于需要重复解释的变量，防止过多“剪切”“复制”。比如一些变量已经在foo1解释了，而foo2需要用foo1的一些变量，就可以使用这个字段。这里的foo1可以是当前包的函数，也可以是其他包函数，比如pkg::foo1。</p></li>

<li><p><code>@return</code>：函数返回的结果。如果想具体解释返回的结果，格式<code>\item{name a}{description a}</code>{:.language-html}。</p></li>

<li><p><code>@author</code>：作者，加上作者邮件地址，格式：<code>\email{MrR@@stat.cn}</code>{:.language-html}。</p></li>

<li><p><code>@examples</code>：给出函数使用的例子。例子非常重要，很多用户对例子的关注要远远高于其他的部分，啰啰嗦嗦说了一大堆，不如来两个漂亮的例子。我认为好的例子应该包括（但不限于）：</p></li>
</ul>

<blockquote>
<ul>
<li><p>重要参数的演示；</p></li>

<li><p>参数之间的协调控制；</p></li>

<li><p>特殊参数（用语言描述困难）的演示；</p></li>

<li><p>可能的错误使用；</p></li>

<li><p>来几张漂亮图。</p></li>
</ul>
</blockquote>

<p>这些例子可以直接使用R代码编排、“#”注释、多行也问题。这些例子可以用函数<code>example()</code>运行。如果不想运行某些例子（比如演示错误使用等），格式：<code>\dontrun{Rcode}</code>{:.language-html}。如果例子中依赖其他包，使用<code>if(require(pkg)){ }</code>格式。如果函数使用了多核运算技术，例子最多只能允许使用2个核，如果使用多个核，会报错。</p>

<p>也可以在包的根目录下建立文件，通过<code>@example path/relative/to/packge/root</code>引用。如果函数不需要输出，则不用添加<code>@example</code>，否则在R包检查中会报错。</p>

<ul>
<li><p><code>@references</code>： 参考文献，比如算法出处、函数编写思路、例子的参考文献等。如果想多行出现，只需再用一次<code>@references</code>即可。如果要网址，格式为<code>\url{http://www.google.com}</code>{:.language-html}。</p></li>

<li><p><code>@seealso</code>：其他可供参考或者有联系的对象，并说明可供参考的原因。如果想在HTML中有超链接，格式为<code>\code{\link{function}}</code>{:.language-html}。</p></li>

<li><p><code>@family</code>：为<code>@seealso</code>提供了另外一种解决方法，将需要相互引用函数编排成一个“家族（family）”，之后同一个家族的函数自动出现在see-also中。同一个函数可以属于多个不同家族。</p></li>

<li><p><code>@note</code>：添加一些注释信息。</p></li>

<li><p><code>@section</code>：用户自定义一个注释区（包括名称和内容）。</p></li>

<li><p><code>@rdname</code>：解决了多个文档合并的问题。可以将多个函数标记为一个共同的<code>@rdname（override name）</code>{:.language-html}，这样在最后的HTML文档中，就可以将多个功能相似或者一个系列的函数总结在一个文档中。如果使用了<code>@rdname</code>，那么<code>@description</code>和<code>@details</code>需要在第一个函数中全部写完，<code>@title</code>也只在第一个函数中出现。</p></li>

<li><p><code>@keywords internal</code>：隐藏函数，不在help文档中显示，在其他包中可以正常使用。</p></li>

<li><p><code>@aliases</code>：命名一个函数的别名，将指向同一个文档；<code>@family</code>：如果几个函数共用一个family name，它们将在seealso中交叉链接；<code>@seealso</code>：其他函数的超链接；<code>@rdname</code>：将多个函数合并在一个文档中。这些标记用于在HTML帮助文档中，可能出现这些超级链接或者文档合并。</p></li>

<li><p>对<code>data</code>文件夹下的R data file进行注释。R data file通常以.RData或者.rda作为文件名扩展。<a href="http://r-pkgs.had.co.nz/data.html#documenting-data">参考数据注释</a>。</p></li>
</ul>

<h2 id="4-写vignittes文件">4. 写vignittes文件</h2>

<p>推荐使用<a href="https://github.com/yihui/knitr"><span style="color: blue">knitr</span>包</a>。</p>

<h2 id="5-其他辅助文件">5. 其他辅助文件</h2>

<h3 id="5-1-news文件">5.1 NEWS文件</h3>

<p>在包根目录下，可以添加<code>NEWS</code>文件，简要说明版本更新特征。参考<a href="https://github.com/hadley/ggplot2/blob/master/NEWS">ggplot2</a>的格式：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">pkgName version
-------------------------
NEW FEATURES

* 1st feature

* 2nd feature

* 3rd feature

BUG FIXES

* fixed bug1

* fixed bug2</pre></div>
<p>也可以在NEWS的最开头加入自己的TODO列表，提示将来需要作的更新。</p>

<h2 id="6-检查和压缩包">6. 检查和压缩包</h2>

<p>在提交代码之前，首先需要检查自己的代码，运行命名</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">R CMD check Mypkg</code></pre></div>
<p>之后，因为R源码包（source package）的发布都是采用压缩文件（<code>*.tar.gz</code>）形式，所以需要将源代码打包，方法是运行命令</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">R CMD build Mypkg</code></pre></div>
<p>当然，有时我们需要发布二进制包（binary packages）,操作方法是</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">R CMD INSTALL --build Mypkg</code></pre></div>
<p>具体执行过程是：首先，在默认目录树下安装包；之后，将成功安装的包转化成（平台依赖的）二进制代码，再将二进制代码打包输出。所以，默认安装目录要有“可写”权限，如果没有，执行<code>R CMD INSTALL -l location --build Mypkg</code>，指定一个“可写”权限目录（location）安装。</p>

<p>CRAN很体贴地考虑了Window以外平台的作者，通过<a href="http://win-builder.r-project.org/">网站</a>上传源码包，之后编译成window平台二进制包。</p>

<p>最后是提交代码，依次执行以下命名或者操作:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">R CMD build Mypkg
<span style="color:#008000"># 检查例子（example）、检查（test）和文档输出，如果有报错或者警告，需要仔细阅读提示，原则上消除所有报错和警告</span>
R CMD check --as-cran</code></pre></div>
<p>使用 <a href="ftp://CRAN.R-project.org/incoming/">ftp://CRAN.R-project.org/incoming/</a> （用户名： anonymous；密码：自己邮箱地址）上传自己的包，并向CRAN@R-project.org发邮件通知自己上传了包（名称、版本等）。</p>

<h2 id="注意事项">注意事项</h2>

<h3 id="1-命名">1. 命名</h3>

<p>给自己的包起一个漂亮的名字，注意大小写，因为一些操作系统可能对大小写不敏感。因此，为了平台兼容性，包的命名尽量不要用大小写区分；不仅如此，在包源代码文件夹下，文件命名也要注意这个问题。起了名字之后，最好到<a href="http://cran.r-project.org/web/packages/available_packages_by_name.html">R包列表</a>去看看，检查下自己包的名字是否与其他人的冲突。</p>

<h3 id="2-名称符号">2. 名称符号</h3>

<blockquote>
<ul>
<li><p>文件名中不允许出现如下符号<code>&quot;</code>、 <code>*</code>、 <code>:</code>、<code>/</code>、<code>&lt;&lt;/font&gt;</code>、 <code>&gt;</code>、 <code>?</code>、 <code>\</code> 和 <code>|</code>；</p></li>

<li><p>文件命名使用的字符包括 <code>A-Za-z0-9._!#$%&amp;+,;=@^(){}'[]</code>，但是不推荐使用 <code>(){}'[]$</code>；</p></li>

<li><p><code>*.Rd</code>文件可以包括URL，但必须是ASCII，不能出现<code>%</code>。</p></li>
</ul>
</blockquote>

<h3 id="3-gnu版本号">3. GNU版本号</h3>

<p>GNU版本命名规则：Major_Version_Number.Minor_Version_Number[.Revision_Number[.Build_Number]]。</p>

<h3 id="4-关于-命名空间-namespace-的讨论">4. 关于“命名空间（namespace）”的讨论</h3>

<p>在制作R包时候，有两种方法可以引用其他包的变量：</p>

<blockquote>
<p><strong>第一种方法</strong>：只需要在<code>NAMESPACE</code>中声明引用<code>import()</code>或者<code>importFrom()</code>，同时在<code>DESCRIPTION</code>中<code>Imports</code>添加需引用的包即可。这样，在编写代码时不用加上<code>require(pkg)</code>之类载入包的语句。在安装过程中，通过引用可以很方便地获取其他包的变量（比如函数），因而避免了载入整个包；对应的，这很大程度上保证了代码的简洁，一个非常不错的设计。</p>

<p>这里需要再多啰嗦两句，<code>require(pkg)</code>和<code>NAMESPACE</code>声明<code>import()</code>有不同，前一个函数载入包，并将其添加（attach）到搜索目录下；而后一个则只载入包，并有添加搜索目录。这有两点好处：1. 用户只将注意力集中在载入的包，如果import()的包中有与载入包命名冲突的函数，只会调用载入的包；2. 设计简洁。</p>

<p><strong>第二种方法</strong>：也可以通过操作符<code>::</code>和<code>:::</code>获得命名空间的“显变量（exported variables）和“隐变量（internal variables）”。需要注意的是，不推荐使用<code>:::</code>，这可能暗示这一个自己设计不足。因为“隐变量”之所以要隐藏起来，作者是有着充分的考虑；而且，这些“隐变量”可能随着作者对包的更新而改名。可以使用函数<code>loadedNamespaces()</code>查看已经载入的命名空间，<code>unloadNamespace(name)</code>卸载命名空间。</p>
</blockquote>

<p>对于这两种方法，不推荐第二种方法，原因很简单：要多写包名+两个冒号。第二中方法适合在终端操作时，遇到函数名称冲突（见后）使用。</p>

<p>如果变量命名有冲突，R将采取“就近”策略应对，考虑两种特殊情况:</p>

<blockquote>
<ol>
<li><p>假定自己包的名称是Mypkg，如果在<code>NAMESPACE</code>中声明输入<code>export(f)</code>，但是又从另外一包foo输入同名函数f，比如<code>importFrom(foo, f)</code>。这时，“就近”策略发挥作用，即在载入包Mypkg时，默认f函数是自己编写的，即声明输出的函数f，而不是foo中的f函数。总体而言，命名空间的查找顺序是：<strong>包的命名空间 &ndash;&gt; import声明 &ndash;&gt; Base包的命名空间 &ndash;&gt; 最后是搜索路径</strong>。</p></li>

<li><p>假定pkg1和pkg2两个包，都有命名空间，而且输出同名函数f。这是，R会怎么处理呢？同样是“就近”原则，哪个包后载入，先用哪个包的函数f。不过，如果函数命名有冲突，后载入的包会给出一个警告“marsked from package: ***”。</p></li>
</ol>
</blockquote>

<h3 id="参考网址资料">参考网址资料</h3>

<ul>
<li><p><a href="https://github.com/yihui/knitr/blob/master/DESCRIPTION">knitr包的DESCRIPTION文件</a></p></li>

<li><p>命名空间讨论：<a href="https://github.com/hadley/devtools/wiki/Namespaces">1</a>、<a href="http://www.r-bloggers.com/namespaces-and-name-conflicts/">2</a>、<a href="http://r-pkgs.had.co.nz/namespace.html">3</a></p></li>

<li><p>其他帮助文档：<a href="http://cos.name/2011/05/write-r-packages-like-a-ninja/">1</a>、<a href="http://yihui.name/knitr/">2</a>、<a href="http://cran.r-project.org/doc/manuals/R-exts.html#Dynamic-pages">3</a>、<a href="http://sjp.co.nz/posts/emacs-ess-knitr/">4</a>、<a href="https://github.com/yihui/knitr/issues/252">5</a>、<a href="http://cos.name/cn/topic/106644">6</a></p></li>

<li><p><a href="https://stackoverflow.com/questions/25605185/how-do-i-add-a-changelog-or-news-file-to-my-r-package">NEWS文件说明</a></p></li>
</ul>

<h3 id="更新记录">更新记录</h3>

<p>2015年8月27日</p>

		</div>

		<div class="post-tags">
			
				
					<nav class="nav tags">
							<ul class="flat">
								
								<li><a href="/tags/r">R</a></li>
								
							</ul>
					</nav>
				
			
		</div></div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> © Copyright notice |  <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-53073828-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
